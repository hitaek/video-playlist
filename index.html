<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video Player with Playlist</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f9f9f9;
    }
    .container {
      display: grid;
      grid-template-columns: 100%;
      grid-gap: 20px;
      padding: 20px;
    }
    .video-container, .playlist-container {
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    .video-player {
      width: 100%;
    }
    .playlist {
      list-style: none;
      padding: 0;
      max-height: 400px;
      overflow-y: auto;
      padding: 10px;
    }
    .playlist-item {
      margin-bottom: 5px;
      cursor: pointer;
      padding: 8px;
      border-radius: 4px;
      background-color: #f0f0f0;
      transition: background-color 0.3s ease;
    }
    .playlist-item:hover {
      background-color: #e0e0e0;
    }
    .input-container {
      margin-top: 20px;
    }
    .playlist-input, button, .upload-btn {
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      transition: border-color 0.3s ease;
      box-sizing: border-box;
      margin-bottom: 10px;
      width: calc(100% - 22px); /* Adjusted */
    }
    .playlist-input:focus {
      border-color: #007bff;
    }
    button, .upload-btn {
      background-color: #eee;
      color: #555;
      cursor: pointer;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    button:hover, .upload-btn:hover {
      background-color: #ddd;
    }
    input[type="file"] {
      display: none;
    }
    .button-container {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
    }
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      padding: 10px;
    }
    .nav-buttons button {
      flex: 1;
    }

    @media only screen and (min-width: 768px) {
      .container {
        grid-template-columns: 70% 30%;
      }
      .input-container {
        grid-column: span 2;
        flex-direction: row;
        align-items: center;
      }
      .playlist-input {
        width: calc(50% - 5px);
        margin-bottom: 0;
        margin-right: 10px;
      }
      .upload-btn {
        width: calc(50% - 5px);
      }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="video-container">
    <video id="my-video" class="video-player" controls autoplay>
      <source src="" type="video/mp4">
      Your browser does not support the video tag.
    </video>
    <div class="nav-buttons">
      <button onclick="playPrevious()">Previous</button>
      <button onclick="playNext()">Next</button>
    </div>
  </div>

  <div class="playlist-container">
    <h2>Playlist</h2>
    <div class="playlist-controls">
      <button id="repeat" onclick="toggleRepeat()">Repeat: OFF</button>
      <button id="shuffle" onclick="toggleShuffle()">Shuffle: OFF</button>
      <input type="text" id="filterInput" onkeyup="filterPlaylist()" placeholder="Filter playlist...">
    </div>
    <ul class="playlist" id="playlist">
      <!-- Playlist items will be dynamically added here -->
    </ul>
  </div>
</div>

<div class="input-container">
  <textarea id="videoInput" class="playlist-input" placeholder="Enter video URLs and titles in CSV format" style="width: 100%"></textarea>
  <div class="button-container">
    <button onclick="createPlaylist()">Create Playlist</button>
    <input type="file" id="fileInput" accept=".m3u, .m3u8" onchange="uploadAndParse()">
    <label for="fileInput" class="upload-btn">Upload Local M3U/M3U8</label>
  </div>
</div>

<div class="shortcut-list">
  <h3>Keyboard Shortcuts:</h3>
  <ul>
    <li>Space: Play/Pause</li>
    <li>Left Arrow: Previous Video</li>
    <li>Right Arrow: Next Video</li>
    <li>R: Toggle Repeat</li>
    <li>S: Toggle Shuffle</li>
  </ul>
</div>

<script>
  var player = document.getElementById('my-video');
  var playlist = document.getElementById('playlist');
  var repeatButton = document.getElementById('repeat');
  var shuffleButton = document.getElementById('shuffle');
  var filterInput = document.getElementById('filterInput');
  var currentPlaylist = [];
  var currentVideoIndex = 0;
  var repeatState = false;
  var shuffleState = false;

  function createPlaylist() {
    var videoInput = document.getElementById('videoInput').value.trim();
    playlist.innerHTML = ''; // Clear previous playlist

    var lines = videoInput.split(/\r?\n/); // Split lines by newline
    lines.forEach(function(line) {
      var parts = line.split(','); // Split line by comma
      if (parts.length >= 2) {
        var url = parts[0].trim();
        var title = parts.slice(1).join(',').trim(); // Join parts after the first comma to handle titles with commas
        var listItem = document.createElement('li');
        listItem.textContent = title;
        listItem.classList.add('playlist-item');
        listItem.onclick = function() {
          playVideo(url);
        };
        playlist.appendChild(listItem);
        currentPlaylist.push({ url: url, title: title });
      }
    });

    if (currentPlaylist.length > 0) {
      currentVideoIndex = 0; // Reset current video index
      playVideo(currentPlaylist[currentVideoIndex].url);
    }
  }

  function playVideo(src) {
    player.src = src;
    player.play();
  }

  function toggleRepeat() {
    repeatState = !repeatState;
    repeatButton.textContent = repeatState ? 'Repeat: ON' : 'Repeat: OFF';
    player.loop = repeatState;
  }

  function toggleShuffle() {
    shuffleState = !shuffleState;
    shuffleButton.textContent = shuffleState ? 'Shuffle: ON' : 'Shuffle: OFF';
    if (shuffleState) {
      shuffleArray(currentPlaylist);
      currentVideoIndex = 0;
      playVideo(currentPlaylist[currentVideoIndex].url);
    }
  }

  function shuffleArray(array) {
    for (var i = array.length - 1; i > 0; i--) {
      var j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  function playNext() {
    currentVideoIndex++;
    if (currentVideoIndex >= currentPlaylist.length) {
      if (repeatState) {
        currentVideoIndex = 0; // Restart playlist
      } else {
        return; // Do nothing if not repeating
      }
    }
    playVideo(currentPlaylist[currentVideoIndex].url);
  }

  function playPrevious() {
    currentVideoIndex--;
    if (currentVideoIndex < 0) {
      currentVideoIndex = currentPlaylist.length - 1; // Go to last video
    }
    playVideo(currentPlaylist[currentVideoIndex].url);
  }

  function filterPlaylist() {
    var filterValue = filterInput.value.toLowerCase();
    var playlistItems = playlist.getElementsByClassName('playlist-item');
    for (var i = 0; i < playlistItems.length; i++) {
      var title = playlistItems[i].textContent.toLowerCase();
      if (title.indexOf(filterValue) > -1) {
        playlistItems[i].style.display = '';
      } else {
        playlistItems[i].style.display = 'none';
      }
    }
  }

  function uploadAndParse() {
    var fileInput = document.getElementById('fileInput');
    if (fileInput.files.length > 0) {
      var file = fileInput.files[0];
      var reader = new FileReader();
      reader.onload = function(e) {
        var lines = e.target.result.split(/\r?\n/);
        lines.forEach(function(line) {
          if (line.startsWith('#EXTINF')) {
            var url = lines[lines.indexOf(line) + 1];
            if (url && url.trim() !== '') {
              var title = line.split(',')[1];
              var listItem = document.createElement('li');
              listItem.textContent = title;
              listItem.classList.add('playlist-item');
              listItem.onclick = function() {
                playVideo(url);
              };
              playlist.appendChild(listItem);
              currentPlaylist.push({ url: url, title: title });
            }
          }
        });
      };
      reader.readAsText(file);
    } else {
      alert('Please select a file to upload.');
    }
  }

  // Keyboard navigation
  document.addEventListener('keydown', function(event) {
    switch (event.key) {
      case ' ':
        if (player.paused) {
          player.play();
        } else {
          player.pause();
        }
        break;
      case 'ArrowLeft':
        playPrevious();
        break;
      case 'ArrowRight':
        playNext();
        break;
      case 'r':
      case 'R':
        toggleRepeat();
        break;
      case 's':
      case 'S':
        toggleShuffle();
        break;
    }
  });
</script>

</body>
</html>
